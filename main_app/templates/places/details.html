{% extends 'base.html' %}
{% block content %}

<div class="m-4 text-dark font-body">
    <h3 class="font-header font-bold text-h4">{{ place.name }}</h3>
    <p class="text-body-lg">{{place.category}}</p>
    <p class="hidden dp:block text-body-lg">{{place.address}}</p>
    <p class="">
        {% if avg_rating %}
        {{ avg_rating|floatformat }}/5 stars
        {% endif %}
    </p>

    {% if is_favourite %}

    <form action="{% url 'remove_favourite' place.id %}" method="POST">
        {% csrf_token %}
        <button type="submit">Remove from Favourites</button>
    </form>


    {% else %}

    <form action="{% url 'add_favourite' place.id %}" method="POST">
        {% csrf_token %}
        <button type="submit">Add to Favourites</button>
    </form>

    {% endif %}

    <h3 class="text-h6 font-header font-bold">Reviews</h3>
    <div class="grid grid-cols-2 gap-4" style="max-height: 450px; overflow-y: auto;">
        {% for review in place.review_set.all %}
            <a href="{% url 'profile_details' review.profile.user.id %}">
                <div class="w-full bg-primary text-dark rounded-lg shadow-md p-4 cursor-pointer">
                    <div class="flex items-center mb-4">
                        <img src="https://via.placeholder.com/50" alt="Avatar" class="w-10 h-10 rounded-full mr-2">
                        <p class="text-body-lg dp:text-h6">{{review.profile.user.username}}</p>
                    </div>
                    <p class="text-body dp:text-body-lg">{{review.comment}}</p>
                    <p class="text-body-sm">{{review.rating}} stars</p>
                    <!-- loop through amenities -->
                    <h3>Amenities</h3>
                    <ul>
                        {% for category, amenities in amenities %}
                        {% for key, label in amenities %}
                    
                        <li>{{ label }}
                        </li>
                    
                        {% endfor %}
                        {% endfor %}
                    </ul>
                    <ul>{% for a in available_amenities %}
                        <li>{{ a }}</li>
                        {% endfor %}
                    </ul>
                    {% if request.user == review.profile.user %}
                        <form action="{% url 'review_delete' pk=review.pk %}" method="POST">
                            {% csrf_token %}
                            <button type="submit">Delete Review</button>
                        </form>
                    {% endif %}
                </div>
            </a>
        {% endfor %}
    </div>
    <a href="{% url 'review_create' place_pk=place.pk %}">
        <button class=" rounded">Add Review</button>
    </a>
</div>
{% endblock %}